// Dart checkout combinations for 501 double out
// Score -> [dart1, dart2, dart3] where each dart is { value, multiplier, display }

const CHECKOUT_MAP = {
    170: [{ v: 20, m: 3 }, { v: 20, m: 3 }, { v: 50, m: 1 }],
    167: [{ v: 20, m: 3 }, { v: 19, m: 3 }, { v: 50, m: 1 }],
    164: [{ v: 20, m: 3 }, { v: 18, m: 3 }, { v: 50, m: 1 }],
    161: [{ v: 20, m: 3 }, { v: 17, m: 3 }, { v: 50, m: 1 }],
    160: [{ v: 20, m: 3 }, { v: 20, m: 3 }, { v: 20, m: 2 }],
    158: [{ v: 20, m: 3 }, { v: 20, m: 3 }, { v: 19, m: 2 }],
    157: [{ v: 20, m: 3 }, { v: 19, m: 3 }, { v: 20, m: 2 }],
    156: [{ v: 20, m: 3 }, { v: 20, m: 3 }, { v: 18, m: 2 }],
    155: [{ v: 20, m: 3 }, { v: 19, m: 3 }, { v: 19, m: 2 }],
    154: [{ v: 20, m: 3 }, { v: 18, m: 3 }, { v: 20, m: 2 }],
    153: [{ v: 20, m: 3 }, { v: 19, m: 3 }, { v: 18, m: 2 }],
    152: [{ v: 20, m: 3 }, { v: 20, m: 3 }, { v: 16, m: 2 }],
    151: [{ v: 20, m: 3 }, { v: 17, m: 3 }, { v: 20, m: 2 }],
    150: [{ v: 20, m: 3 }, { v: 18, m: 3 }, { v: 18, m: 2 }],
    149: [{ v: 20, m: 3 }, { v: 19, m: 3 }, { v: 16, m: 2 }],
    148: [{ v: 20, m: 3 }, { v: 20, m: 3 }, { v: 14, m: 2 }],
    147: [{ v: 20, m: 3 }, { v: 17, m: 3 }, { v: 18, m: 2 }],
    146: [{ v: 20, m: 3 }, { v: 18, m: 3 }, { v: 16, m: 2 }],
    145: [{ v: 20, m: 3 }, { v: 19, m: 3 }, { v: 14, m: 2 }],
    144: [{ v: 20, m: 3 }, { v: 20, m: 3 }, { v: 12, m: 2 }],
    143: [{ v: 20, m: 3 }, { v: 17, m: 3 }, { v: 16, m: 2 }],
    142: [{ v: 20, m: 3 }, { v: 14, m: 3 }, { v: 20, m: 2 }],
    141: [{ v: 20, m: 3 }, { v: 19, m: 3 }, { v: 12, m: 2 }],
    140: [{ v: 20, m: 3 }, { v: 20, m: 3 }, { v: 10, m: 2 }],
    139: [{ v: 20, m: 3 }, { v: 13, m: 3 }, { v: 20, m: 2 }],
    138: [{ v: 20, m: 3 }, { v: 18, m: 3 }, { v: 12, m: 2 }],
    137: [{ v: 20, m: 3 }, { v: 19, m: 3 }, { v: 10, m: 2 }],
    136: [{ v: 20, m: 3 }, { v: 20, m: 3 }, { v: 8, m: 2 }],
    135: [{ v: 20, m: 3 }, { v: 17, m: 3 }, { v: 12, m: 2 }],
    134: [{ v: 20, m: 3 }, { v: 14, m: 3 }, { v: 16, m: 2 }],
    133: [{ v: 20, m: 3 }, { v: 19, m: 3 }, { v: 8, m: 2 }],
    132: [{ v: 25, m: 1 }, { v: 20, m: 3 }, { v: 17, m: 3 }, { v: 16, m: 2 }],
    131: [{ v: 20, m: 3 }, { v: 13, m: 3 }, { v: 16, m: 2 }],
    130: [{ v: 20, m: 3 }, { v: 20, m: 3 }, { v: 5, m: 2 }],
    129: [{ v: 19, m: 3 }, { v: 16, m: 3 }, { v: 12, m: 2 }],
    128: [{ v: 18, m: 3 }, { v: 14, m: 3 }, { v: 16, m: 2 }],
    127: [{ v: 20, m: 3 }, { v: 17, m: 3 }, { v: 8, m: 2 }],
    126: [{ v: 19, m: 3 }, { v: 19, m: 3 }, { v: 6, m: 2 }],
    125: [{ v: 25, m: 1 }, { v: 20, m: 3 }, { v: 20, m: 2 }],
    124: [{ v: 20, m: 3 }, { v: 14, m: 3 }, { v: 11, m: 2 }],
    123: [{ v: 19, m: 3 }, { v: 16, m: 3 }, { v: 9, m: 2 }],
    122: [{ v: 18, m: 3 }, { v: 18, m: 3 }, { v: 7, m: 2 }],
    121: [{ v: 20, m: 3 }, { v: 11, m: 3 }, { v: 14, m: 2 }],
    120: [{ v: 20, m: 3 }, { v: 20, m: 1 }, { v: 20, m: 2 }],
    119: [{ v: 19, m: 3 }, { v: 12, m: 3 }, { v: 13, m: 2 }],
    118: [{ v: 20, m: 3 }, { v: 18, m: 1 }, { v: 20, m: 2 }],
    117: [{ v: 20, m: 3 }, { v: 17, m: 1 }, { v: 20, m: 2 }],
    116: [{ v: 20, m: 3 }, { v: 16, m: 1 }, { v: 20, m: 2 }],
    115: [{ v: 20, m: 3 }, { v: 15, m: 1 }, { v: 20, m: 2 }],
    114: [{ v: 20, m: 3 }, { v: 14, m: 1 }, { v: 20, m: 2 }],
    113: [{ v: 20, m: 3 }, { v: 13, m: 1 }, { v: 20, m: 2 }],
    112: [{ v: 20, m: 3 }, { v: 12, m: 1 }, { v: 20, m: 2 }],
    111: [{ v: 20, m: 3 }, { v: 19, m: 1 }, { v: 16, m: 2 }],
    110: [{ v: 20, m: 3 }, { v: 18, m: 1 }, { v: 16, m: 2 }],
    109: [{ v: 20, m: 3 }, { v: 17, m: 1 }, { v: 16, m: 2 }],
    108: [{ v: 20, m: 3 }, { v: 16, m: 1 }, { v: 16, m: 2 }],
    107: [{ v: 19, m: 3 }, { v: 18, m: 1 }, { v: 16, m: 2 }],
    106: [{ v: 20, m: 3 }, { v: 14, m: 1 }, { v: 16, m: 2 }],
    105: [{ v: 20, m: 3 }, { v: 13, m: 1 }, { v: 16, m: 2 }],
    104: [{ v: 18, m: 3 }, { v: 18, m: 1 }, { v: 16, m: 2 }],
    103: [{ v: 19, m: 3 }, { v: 14, m: 1 }, { v: 16, m: 2 }],
    102: [{ v: 20, m: 3 }, { v: 10, m: 1 }, { v: 16, m: 2 }],
    101: [{ v: 17, m: 3 }, { v: 18, m: 1 }, { v: 16, m: 2 }],
    100: [{ v: 20, m: 3 }, { v: 20, m: 2 }],
    99: [{ v: 19, m: 3 }, { v: 10, m: 1 }, { v: 16, m: 2 }],
    98: [{ v: 20, m: 3 }, { v: 19, m: 2 }],
    97: [{ v: 19, m: 3 }, { v: 20, m: 2 }],
    96: [{ v: 20, m: 3 }, { v: 18, m: 2 }],
    95: [{ v: 19, m: 3 }, { v: 19, m: 2 }],
    94: [{ v: 18, m: 3 }, { v: 20, m: 2 }],
    93: [{ v: 19, m: 3 }, { v: 18, m: 2 }],
    92: [{ v: 20, m: 3 }, { v: 16, m: 2 }],
    91: [{ v: 17, m: 3 }, { v: 20, m: 2 }],
    90: [{ v: 18, m: 3 }, { v: 18, m: 2 }],
    89: [{ v: 19, m: 3 }, { v: 16, m: 2 }],
    88: [{ v: 16, m: 3 }, { v: 20, m: 2 }],
    87: [{ v: 17, m: 3 }, { v: 18, m: 2 }],
    86: [{ v: 18, m: 3 }, { v: 16, m: 2 }],
    85: [{ v: 15, m: 3 }, { v: 20, m: 2 }],
    84: [{ v: 20, m: 3 }, { v: 12, m: 2 }],
    83: [{ v: 17, m: 3 }, { v: 16, m: 2 }],
    82: [{ v: 14, m: 3 }, { v: 20, m: 2 }],
    81: [{ v: 19, m: 3 }, { v: 12, m: 2 }],
    80: [{ v: 20, m: 3 }, { v: 10, m: 2 }],
    79: [{ v: 13, m: 3 }, { v: 20, m: 2 }],
    78: [{ v: 18, m: 3 }, { v: 12, m: 2 }],
    77: [{ v: 19, m: 3 }, { v: 10, m: 2 }],
    76: [{ v: 20, m: 3 }, { v: 8, m: 2 }],
    75: [{ v: 17, m: 3 }, { v: 12, m: 2 }],
    74: [{ v: 14, m: 3 }, { v: 16, m: 2 }],
    73: [{ v: 19, m: 3 }, { v: 8, m: 2 }],
    72: [{ v: 16, m: 3 }, { v: 12, m: 2 }],
    71: [{ v: 13, m: 3 }, { v: 16, m: 2 }],
    70: [{ v: 20, m: 3 }, { v: 5, m: 2 }],
    69: [{ v: 19, m: 3 }, { v: 6, m: 2 }],
    68: [{ v: 20, m: 3 }, { v: 4, m: 2 }],
    67: [{ v: 17, m: 3 }, { v: 8, m: 2 }],
    66: [{ v: 10, m: 3 }, { v: 18, m: 2 }],
    65: [{ v: 19, m: 3 }, { v: 4, m: 2 }],
    64: [{ v: 16, m: 3 }, { v: 8, m: 2 }],
    63: [{ v: 13, m: 3 }, { v: 12, m: 2 }],
    62: [{ v: 10, m: 3 }, { v: 16, m: 2 }],
    61: [{ v: 15, m: 3 }, { v: 8, m: 2 }],
    60: [{ v: 20, m: 1 }, { v: 20, m: 2 }],
    59: [{ v: 19, m: 1 }, { v: 20, m: 2 }],
    58: [{ v: 18, m: 1 }, { v: 20, m: 2 }],
    57: [{ v: 17, m: 1 }, { v: 20, m: 2 }],
    56: [{ v: 16, m: 1 }, { v: 20, m: 2 }],
    55: [{ v: 15, m: 1 }, { v: 20, m: 2 }],
    54: [{ v: 14, m: 1 }, { v: 20, m: 2 }],
    53: [{ v: 13, m: 1 }, { v: 20, m: 2 }],
    52: [{ v: 12, m: 1 }, { v: 20, m: 2 }],
    51: [{ v: 11, m: 1 }, { v: 20, m: 2 }],
    50: [{ v: 50, m: 1 }],
    49: [{ v: 9, m: 1 }, { v: 20, m: 2 }],
    48: [{ v: 16, m: 1 }, { v: 16, m: 2 }],
    47: [{ v: 15, m: 1 }, { v: 16, m: 2 }],
    46: [{ v: 14, m: 1 }, { v: 16, m: 2 }],
    45: [{ v: 13, m: 1 }, { v: 16, m: 2 }],
    44: [{ v: 12, m: 1 }, { v: 16, m: 2 }],
    43: [{ v: 11, m: 1 }, { v: 16, m: 2 }],
    42: [{ v: 10, m: 1 }, { v: 16, m: 2 }],
    41: [{ v: 9, m: 1 }, { v: 16, m: 2 }],
    40: [{ v: 20, m: 2 }],
    39: [{ v: 7, m: 1 }, { v: 16, m: 2 }],
    38: [{ v: 6, m: 1 }, { v: 16, m: 2 }],
    37: [{ v: 5, m: 1 }, { v: 16, m: 2 }],
    36: [{ v: 18, m: 2 }],
    35: [{ v: 3, m: 1 }, { v: 16, m: 2 }],
    34: [{ v: 17, m: 2 }],
    33: [{ v: 1, m: 1 }, { v: 16, m: 2 }],
    32: [{ v: 16, m: 2 }],
    31: [{ v: 15, m: 1 }, { v: 8, m: 2 }],
    30: [{ v: 15, m: 2 }],
    29: [{ v: 13, m: 1 }, { v: 8, m: 2 }],
    28: [{ v: 14, m: 2 }],
    27: [{ v: 11, m: 1 }, { v: 8, m: 2 }],
    26: [{ v: 13, m: 2 }],
    25: [{ v: 9, m: 1 }, { v: 8, m: 2 }],
    24: [{ v: 12, m: 2 }],
    23: [{ v: 7, m: 1 }, { v: 8, m: 2 }],
    22: [{ v: 11, m: 2 }],
    21: [{ v: 5, m: 1 }, { v: 8, m: 2 }],
    20: [{ v: 10, m: 2 }],
    19: [{ v: 3, m: 1 }, { v: 8, m: 2 }],
    18: [{ v: 9, m: 2 }],
    17: [{ v: 1, m: 1 }, { v: 8, m: 2 }],
    16: [{ v: 8, m: 2 }],
    15: [{ v: 7, m: 1 }, { v: 4, m: 2 }],
    14: [{ v: 7, m: 2 }],
    13: [{ v: 5, m: 1 }, { v: 4, m: 2 }],
    12: [{ v: 6, m: 2 }],
    11: [{ v: 3, m: 1 }, { v: 4, m: 2 }],
    10: [{ v: 5, m: 2 }],
    9: [{ v: 1, m: 1 }, { v: 4, m: 2 }],
    8: [{ v: 4, m: 2 }],
    7: [{ v: 3, m: 1 }, { v: 2, m: 2 }],
    6: [{ v: 3, m: 2 }],
    5: [{ v: 1, m: 1 }, { v: 2, m: 2 }],
    4: [{ v: 2, m: 2 }],
    3: [{ v: 1, m: 1 }, { v: 1, m: 2 }],
    2: [{ v: 1, m: 2 }],
}

// Bogey numbers - impossible to checkout
const BOGEY_NUMBERS = [169, 168, 166, 165, 163, 162, 159]

function formatDart(dart) {
    if (dart.v === 50) return 'Bull'
    if (dart.v === 25) return '25'

    const prefix = dart.m === 3 ? 'T' : dart.m === 2 ? 'D' : ''
    return `${prefix}${dart.v}`
}

export function getCheckout(score) {
    if (score <= 1 || score > 170) return null
    if (BOGEY_NUMBERS.includes(score)) return null

    const checkout = CHECKOUT_MAP[score]
    if (!checkout) return null

    return checkout.map(dart => ({
        value: dart.v,
        multiplier: dart.m,
        display: formatDart(dart),
        points: dart.v * dart.m
    }))
}

export function hasCheckout(score) {
    return score >= 2 && score <= 170 && !BOGEY_NUMBERS.includes(score) && CHECKOUT_MAP[score] !== undefined
}

export function useCheckoutRecommendation(currentScore) {
    if (!hasCheckout(currentScore)) {
        return {
            canCheckout: false,
            checkout: null,
            displayText: null
        }
    }

    const checkout = getCheckout(currentScore)
    const displayText = checkout.map(d => d.display).join(' â†’ ')

    return {
        canCheckout: true,
        checkout,
        displayText
    }
}

export default useCheckoutRecommendation
